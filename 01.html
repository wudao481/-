<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <!-- 微信浏览器专用meta标签 -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>遗音天书</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            min-height: 100vh;
            background: linear-gradient(rgba(10, 25, 47, 0.85), rgba(10, 25, 47, 0.7)), url('https://picsum.photos/id/152/1920/1080') no-repeat center center fixed;
            background-size: cover;
            color: #e0e0e0;
            font-family: 'SimSun', 'STSong', serif;
            overflow-x: hidden;
            line-height: 1.8;
        }
        .fog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .container {
            position: relative;
            z-index: 2;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(128, 216, 255, 0.3);
        }
        header h1 {
            font-size: 2.5rem;
            color: #f8f8f8;
            text-shadow: 0 0 10px rgba(128, 216, 255, 0.8), 0 0 20px rgba(128, 216, 255, 0.5);
            margin-bottom: 0.5rem;
        }
        .scene {
            background: rgba(10, 25, 47, 0.75);
            border: 1px solid rgba(128, 216, 255, 0.3);
            border-radius: 10px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            position: relative;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .scene:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            opacity: 0.15;
            border-radius: 10px;
            z-index: -1;
        }
        /* 不同场景的背景图 */
        #intro-scene:before {
            background-image: url('https://picsum.photos/id/1048/800/600');
            background-position: center;
        }
        #紫云洞-scene:before {
            background-image: url('https://picsum.photos/id/29/800/600');
            background-position: center;
        }
        #紫云洞-选择-scene:before {
            background-image: url('https://picsum.photos/id/129/800/600');
            background-position: center;
        }
        #紫云洞-探索-scene:before {
            background-image: url('https://picsum.photos/id/110/800/600');
            background-position: center;
        }
        #福星观-scene:before {
            background-image: url('https://picsum.photos/id/184/800/600');
            background-position: center;
        }
        .dialogue {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
        }
        /* 黄色离开按钮样式 */
        .exit-btn {
            background-color: #ffd700; /* 黄色 */
            color: #000; /* 黑色文字 */
            border: 1px solid #ccc;
            padding: 8px 16px;
            margin-top: 15px;
            cursor: pointer;
        }
        .choices {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .choice-btn {
            padding: 0.8rem 2rem;
            background: rgba(10, 25, 47, 0.6);
            border: 1px solid rgba(128, 216, 255, 0.5);
            border-radius: 20px;
            color: #e0e0e0;
            font-family: 'SimSun', serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .choice-btn:hover {
            background: rgba(128, 216, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(128, 216, 255, 0.5);
        }
        .scene-content { display: none; }
        .scene-content.active { display: block; animation: fadeIn 1s ease; }
        .character {
            color: #80d8ff;
            font-weight: bold;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(128, 216, 255, 0.3);
            font-size: 0.9rem;
            color: #b0b0b0;
        }
        /* 音乐控制按钮样式 */
        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(10, 25, 47, 0.7);
            border: 1px solid rgba(128, 216, 255, 0.5);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .music-control:hover {
            background: rgba(128, 216, 255, 0.2);
            box-shadow: 0 0 15px rgba(128, 216, 255, 0.5);
        }
        .music-icon {
            color: #80d8ff;
            font-size: 24px;
        }
        /* 弹出提示框样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: rgba(10, 25, 47, 0.9);
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 12px;
            padding: 2rem;
            max-width: 80%;
            width: 500px;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
            position: relative;
        }
        .modal-text {
            color: #f0e68c;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }
        .close-modal {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.5);
            border-radius: 8px;
            color: #f0e68c;
            padding: 0.5rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'SimSun', serif;
        }
        .close-modal:hover {
            background: rgba(212, 175, 55, 0.4);
        }
        /* 剧情扩展提示样式 */
        .extend-hint {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(128, 216, 255, 0.1);
            border: 1px dashed rgba(128, 216, 255, 0.3);
            border-radius: 8px;
            font-style: italic;
            color: #b0d8ff;
        }
    </style>
</head>
<body>
    <!-- 音乐控制按钮 -->
    <div class="music-control" id="musicControl">
        <span id="musicIcon">▶</span>
    </div>

    <!-- 背景音乐音频 -->
    <audio id="backgroundMusic" src="叩桐 - 华胥引.mp3" loop></audio>
    <div class="fog"></div>
    <!-- 添加弹出提示框元素 -->
    <!-- 修改hintModal2的关闭按钮 -->
    <div class="modal-overlay" id="hintModal2">
        <div class="modal-content">
            <p class="modal-text">若是路途遥远，可以使用神行符以逸待劳，也可花钱去吟潮驿问问。</p>
            <div style="text-align: center;">
                <button class="close-modal" onclick="{
                    document.getElementById('hintModal2').classList.remove('active');
                    showScene('紫来洞-离开'); // 跳转原离开按钮目标页面
                }">知晓了</button>
            </div>
        </div>
    </div>
    <!-- 添加弹出提示框元素 -->
    <div class="modal-overlay" id="hintModal1">
        <div class="modal-content">
            <p class="modal-text">往山上走走，或许能找到合适的木头。吟潮驿接待往来商旅，说不定也有适合做琴的木头。</p>
            <div style="text-align: center;">
                <button class="close-modal" onclick="document.getElementById('hintModal1').classList.remove('active')">知晓了</button>
            </div>
        </div>
    </div>
    <div class="container">
        <header>
            <h1>遗音天书</h1>
            <p>墨子妄念 · 太元遗音</p>
        </header>

        <!-- 初始场景 -->
        <div id="intro-scene" class="scene scene-content active">
            <div class="dialogue">
                <!-- 修改说明：更新初始场景描述，补充紫来洞背景 -->
                <p>钱塘城南，有一座玉皇山。</p>
                <p>玉皇山的半山腰有一个紫来洞。</p>
                <p>据说这洞中，常年弥漫着仙气，从洞内往上观去，阳光下可以看见紫色的气蕴，洞名据此而来。</p>
                <p>根据居住在山脚八卦田的农家所言，此洞内住着一位会弹琴的墨绿袍子仙人，该仙人时常携琴在八卦田的上空悬停演奏，每一次演奏之后，八卦田的植物都会涨势喜人。</p>
                <p>虽然没有人知道他的名字，但是八卦田附近的农家，家家户户都挂着该仙人的画像，奉其为司植大琴师。</p>
                <p>你若问这大琴师的真容，到还真的没有人见过呢！</p>
                <p>玉皇山的山顶，有一座福星观。</p>
                <p>这座道观是某一天突然从天边飞来的，大家都说那是道祖三清居住的行宫。</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-主场景')">前往紫来洞</button>

            </div>
        </div>

        <!-- 主1.1：紫来洞主场景 -->
        <div id="紫来洞-主场景-scene" class="scene scene-content">
            <div class="dialogue">
                <!-- 修改说明：替换原紫云洞内容为用户提供的主1.1剧情 -->
                <p>你来到紫来洞，看见洞口有一张石床。你喊了几声，无人应答。</p>
                <p>路过的砍柴人看到你，说道："是慕名来找大琴师的？你找不到他的！我们都进去找过，就是个普通山洞，看不出有人住的样子！但我们常听到洞内传来琴声，你不信可以进去看看。"</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-进入探索')">进入洞内探索</button>
                <button class="choice-btn" onclick="showScene('紫来洞-引蛇出洞')">引蛇出洞</button>
            </div>
        </div>

        <!-- 主1.1.1：进入洞内探索 -->
        <div id="紫来洞-进入探索-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你在准备进入洞内时发现了一个结界，你尝试打破结界，发现对结界毫无影响。你选择：</p>
            </div>
            <div class="choices">
                <!-- 修改说明：新增两个子选项对应主1.1.1.1和主1.1.1.2 -->
                <button class="choice-btn" onclick="showScene('紫来洞-找帮手')">寻找帮手破结界</button>
                <button class="choice-btn" onclick="showScene('紫来洞-行大礼')">行大礼求赐见</button>
            </div>
        </div>

        <!-- 主1.1.1.1：寻找帮手 -->
        <div id="紫来洞-找帮手-scene" class="scene scene-content">
            <div class="dialogue">
                <p>西湖边的葛岭，有个抱扑道观，你可以去看看那边有没有破解结界的方法</p>
                <div style="text-align: center; margin-top: 30px;"><button class="exit-btn" onclick="alert('任务完成，请联系DM提交当前页面截图')">完成任务</button></div>
        </div>
            </div>
        </div>

        <!-- 主1.1.1.2：行大礼求赐见 -->
        <div id="紫来洞-行大礼-scene" class="scene scene-content">
            <div class="dialogue">
                <p>跪拜说明缘由之后，突然听见了熟悉的琴声。这琴声，你似曾相识。</p>
                <p>随着琴声缓缓传入你的耳朵，你面前的景色开始变幻，一位穿着墨绿色长袍的散发男子出现在了你的面前。散发男子说到：“原是故人之子，故有故人之姿。</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-问故人')">询问"故人之子"含义</button>
                <button class="choice-btn" onclick="showScene('紫来洞-问瘴气')">询问瘴气来源</button>
            </div>
        </div>

        <!-- 主1.1.1.2.1：询问故人含义 -->
        <div id="紫来洞-问故人-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你问："故人之子"是何意？“</p>
                <p>散发男子：“此乃天机，不可泄露。不过……罢了，你若是愿做我的徒弟，学完琴曲《缚神操》之后，自然可见前世往生。” </p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-拜师')">拜师学艺</button>
                <button class="choice-btn" onclick="showScene('紫来洞-拒绝拜师')">不学</button>

            </div>
        </div>

        <!-- 主1.1.1.2.1.1：拜师学艺 -->
        <div id="紫来洞-拜师-scene" class="scene scene-content">
           
            <div class="dialogue">
                <p>在行完拜师之礼后，散发男子对你说：“先上山找一段合适你的木头回来做琴。”</p>
                <div style="text-align: center; margin-top: 30px;"><button class="exit-btn" onclick="alert('任务完成，请联系DM提交当前页面截图')">完成任务</button></div>
        </div>
            </div>

        </div>

        <!-- 主1.1.1.2.1.2：拒绝拜师 -->
        <div id="紫来洞-拒绝拜师-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你觉得他神神叨叨，决定先打再说！</p>
                <p>掷骰决胜负，若得三个六则胜，否则败。</p>
                
                <!-- 骰子容器 -->
                <div class="dice-container">
                    <div class="dice" id="dice1"></div>
                    <div class="dice" id="dice2"></div>
                    <div class="dice" id="dice3"></div>
                </div>
                
                <!-- 结果显示 -->
                <div id="dice-result" class="dice-result"></div>
            </div>
            <div class="choices">
                <button class="choice-btn" id="roll-dice-btn">掷仙骰定胜负</button>
            
            </div>
        </div>

        <!-- 主1.1.2：引蛇出洞 -->
        <div id="紫来洞-引蛇出洞-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你向砍柴人买了柴火，在洞门口烧火。但晴朗天空突降大雨，火全被浇灭。</p>
                <p>无奈之下，你只能进山洞避雨...</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-进入探索')">进洞避雨</button>
            </div>
        </div>

        <div id="紫云洞-探索-选择1-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你尝试调动体内的灵力（如果有的话）冲击结界...</p>
                <p>令你惊讶的是，当你的灵力接触到结界时，它并没有被反弹，反而像是找到了出口一般，缓缓渗入结界之中。</p>
                <p>结界上泛起一圈圈涟漪，随后竟慢慢打开了一个仅容一人通过的缺口。</p>
                <p>你犹豫了一下，还是决定进入洞内。</p>
                <p>洞内光线昏暗，但空气却异常清新。走了约莫一盏茶的功夫，你眼前豁然开朗，一个宽敞的石室出现在眼前。</p>
                <p>石室中央，一位白衣男子正坐在石凳上抚琴，琴音悠扬，令人心旷神怡。</p>
                <p>见到你进来，男子停下了手中的动作，缓缓抬起头，目光如炬地看着你：</p>
                <p><span class="character">白衣男子：</span>「你终于来了。我等这一天，已经等了三百年了。」</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫云洞-拜师')">1、询问男子身份和等待的原因</button>
                <button class="choice-btn" onclick="showScene('紫云洞-离开')">2、感觉不对劲，想要离开</button>
               
            </div>
        </div>

        <!-- 新增紫云洞拜师场景 -->
        <div id="紫云洞-拜师-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你鼓起勇气问道：「前辈是谁？为何说等我三百年？」</p>
                <p>白衣男子微微一笑，道：「我乃紫云洞洞主，人称紫霞真人。三百年前，我曾算出今日会有一位与我有缘之人来到这里。」</p>
                <p>他指了指旁边的石凳，道：「坐吧。我看你骨骼清奇，是块修仙的好材料，可愿拜我为师？」</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫云洞-拜师-同意')">同意拜师</button>
                <button class="choice-btn" onclick="showScene('紫云洞-拜师-拒绝')">婉言拒绝</button>
                
            </div>
        </div>

        <!-- 新增紫云洞离开场景 -->
        <div id="紫云洞-离开-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你觉得此事太过蹊跷，决定离开这个是非之地。</p>
                <p>然而，当你转身准备走出石室时，却发现入口已经消失不见了。</p>
                <p><span class="character">白衣男子：</span>「既然来了，就不必急着走了。留下来陪我聊聊天吧。」</p>
                <p>他的声音明明很温和，却带有一种不容抗拒的力量。</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫云洞-被困')">1、试图寻找其他出口</button>
                <button class="choice-btn" onclick="showScene('紫云洞-对话')">2、无奈之下，只能与男子对话</button>
                
            </div>
        </div>

        <div id="紫云洞-探索-选择2-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你开始仔细观察结界，寻找可能的薄弱点...</p>
                <!-- 此处预留剧情扩展空间 -->
            </div>

            <div class="extend-hint">
                此处可扩展寻找薄弱点路线的具体剧情
            </div>
        </div>

        <div id="紫云洞-探索-选择3-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你决定返回洞口，重新思考突破结界的方法...</p>
                <!-- 此处预留剧情扩展空间 -->
            </div>
            <div class="extend-hint">
                此处可扩展返回思考路线的具体剧情
            </div>
        </div>

        <div id="紫来洞-穿长袍-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你捡起道袍，那袍子突然就飞到了你的身上。此时，散发男子哈哈大笑说到：“我就说嘛！你该是我墨派弟子！如今道袍加身，是所谓天将降大任于斯人也！”</p>
                <p>那件袍子自从上了你的身，就怎么也脱不掉了。散发男子说：等你通过师门试炼的那一天，自然会教你御袍术。</p>
                <p>无奈之下，你只好选择：</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-拜师')">拜师</button>
            </div>
        </div>


        <!-- 新增：统一离开页面场景 -->
        <div id="紫来洞-离开-scene" class="scene scene-content">
            <div class="dialogue">
                <p>请前往下一点位</p>
                <p>联系DM使用神行符！</p>
            </div>
        </div>
        



        

        </div>
        <!-- 主1.1.1.2.2：询问瘴气来源 -->
        <div id="紫来洞-问瘴气-scene" class="scene scene-content">
            <div class="dialogue">
                <p>你问道："不知钱塘天空弥漫的瘴气从何而来？可有办法驱除？"</p>
                <p><span class="character">大琴师：</span>"我被锁神丹困于此地方圆十里之内，瘴气之事，恐怕是心有余而力不足啊！"</p>
                <p><span class="character">大琴师：</span>"不过，我门的确有驱除瘴气的功法。你若有心造福百姓，不妨在我处苦修一段时日，待你学成之后，便可自行前往驱逐瘴气。"</p>
            </div>
            <div class="choices">
                <button class="choice-btn" onclick="showScene('紫来洞-拜师')">决定拜师学艺</button>
                <button class="choice-btn" onclick="showScene('紫来洞-拒绝拜师')">再考虑考虑</button>
            </div>
        </div>

        <div class="footer">
            <p>风云钱塘 · 湖滨印象</p>
        </div>
    </div>

    <script>
        // 创建云雾效果
        function createFog() {
            const fog = document.querySelector('.fog');
            for (let i = 0; i < 20; i++) {
                const fogElement = document.createElement('div');
                fogElement.style.position = 'absolute';
                fogElement.style.width = `${Math.random() * 300 + 100}px`;
                fogElement.style.height = `${Math.random() * 200 + 100}px`;
                fogElement.style.background = `rgba(255, 255, 255, ${Math.random() * 0.1 + 0.05})`;
                fogElement.style.borderRadius = '50%';
                fogElement.style.top = `${Math.random() * 100}%`;
                fogElement.style.left = `${Math.random() * 100}%`;
                fogElement.style.animation = `float ${Math.random() * 30 + 20}s linear infinite`;
                fog.appendChild(fogElement);
            }
        }

        // 场景切换功能
        function showScene(sceneName) {
            // 隐藏所有场景
            document.querySelectorAll('.scene-content').forEach(scene => {
                scene.classList.remove('active');
            });

            // 显示选中场景
            let targetScene;
            if (sceneName === 'intro') {
                targetScene = document.getElementById('intro-scene');
            } else {
                targetScene = document.getElementById(`${sceneName}-scene`);
            }
            targetScene.classList.add('active');

            // 特定场景显示时弹出提示框
            // if (sceneName === '紫来洞-找帮手') {
            //     setTimeout(() => {
            //         document.getElementById('hintModal2').classList.add('active');
            //     }, 500); // 延迟500ms显示，确保场景加载完成
            // } 
            // if (sceneName === '紫来洞-拜师') {
            //     setTimeout(() => {
            //         document.getElementById('hintModal1').classList.add('active');
            //     }, 500); // 延迟500ms显示，确保场景加载完成
            // } 

            // 滚动到顶部
            window.scrollTo(0, 0);
        }

        // 骰子功能
        const rollDiceBtn = document.getElementById('roll-dice-btn');
        const dice1 = document.getElementById('dice1');
        const dice2 = document.getElementById('dice2');
        const dice3 = document.getElementById('dice3');
        const diceResult = document.getElementById('dice-result');

        // 检查元素是否存在
        if (rollDiceBtn && dice1 && dice2 && dice3 && diceResult) {
            // 添加点击事件
            rollDiceBtn.addEventListener('click', () => {
                // 禁用按钮防止重复点击
                rollDiceBtn.disabled = true;
                rollDiceBtn.textContent = '掷骰中...';
                
                // 清空之前的结果
                diceResult.textContent = '';
                
                // 添加滚动动画
                dice1.classList.add('rolling');
                dice2.classList.add('rolling');
                dice3.classList.add('rolling');
                
                // 随机生成骰子点数
                setTimeout(() => {
                    const result1 = Math.floor(Math.random() * 6) + 1;
                    const result2 = Math.floor(Math.random() * 6) + 1;
                    const result3 = Math.floor(Math.random() * 6) + 1;
                    
                    // 显示结果
                    dice1.textContent = result1;
                    dice2.textContent = result2;
                    dice3.textContent = result3;
                    
                    // 移除滚动动画
                    dice1.classList.remove('rolling');
                    dice2.classList.remove('rolling');
                    dice3.classList.remove('rolling');
                    
                    // 判断结果
                    if (result1 === 6 && result2 === 6 && result3 === 6) {
                        // 原胜利提示改为长袍获取提示（关键修改）
                        diceResult.innerHTML = '恭喜！获得三个六，你赢了！<br>恭喜获得墨绿色长袍';
                        diceResult.style.color = '#4CAF50';

                        // 创建捡起按钮（新增）
                        const pickUpBtn = document.createElement('button');
                        pickUpBtn.textContent = '捡起';
                        pickUpBtn.className = 'choice-btn';
                        pickUpBtn.onclick = () => {
                            // 跳转至新页面（关键场景）
                            showScene('紫来洞-穿长袍');

                            // 移除当前按钮和提示（可选优化）
                            pickUpBtn.remove();
                            diceResult.textContent = '';
                        };
                        diceResult.appendChild(pickUpBtn);
                    } else {
                        diceResult.textContent = '你输了，被迫拜师。';
                        diceResult.style.color = '#F44336';

                        // 用英文变量名避免兼容性问题（关键修改）
                        const masterBtn = document.createElement('button');
                        masterBtn.textContent = '【拜师】';
                        masterBtn.className = 'choice-btn';
                        masterBtn.onclick = () => {
                            // 添加控制台日志便于调试（新增）
                            console.log('点击拜师按钮，尝试跳转场景');
                            showScene('紫来洞-拜师');
                            rollDiceBtn.disabled = false;
                            rollDiceBtn.textContent = '掷仙骰定胜负';
                            masterBtn.remove();
                        };

                        // 确保diceResult存在再添加（新增安全检查）
                        if (diceResult) {
                            diceResult.appendChild(masterBtn);
                        } else {
                            console.error('dice-result元素不存在，无法添加按钮');
                        }
                    }

                    // 移除原来的自动跳转代码（关键修改点）
                    /* 原自动跳转代码删除：
                    setTimeout(() => {
                        showScene('紫来洞-拜师');
                        rollDiceBtn.disabled = false;
                        rollDiceBtn.textContent = '掷仙骰定胜负';
                    }, 2000);
                    */
                }, 1500); // 1.5秒后显示结果
            });
        }

        // 音乐控制功能 - 适配微信浏览器
        const musicControl = document.getElementById('musicControl');
        const musicIcon = document.getElementById('musicIcon');
        const backgroundMusic = document.getElementById('backgroundMusic');
        let isPlaying = false;

        // 微信浏览器中，音频必须由用户交互触发
        musicIcon.textContent = '▶';

        // 音乐控制按钮点击事件
        musicControl.addEventListener('click', () => {
            if (isPlaying) {
                backgroundMusic.pause();
                musicIcon.textContent = '▶';
            } else {
                backgroundMusic.play().then(() => {
                    musicIcon.textContent = '⏸';
                }).catch(err => {
                    alert('请点击允许播放音频');
                    console.log('播放失败:', err);
                });
            }
            isPlaying = !isPlaying;
        });

        // 微信浏览器兼容性处理
        function isWeChatBrowser() {
            const userAgent = navigator.userAgent.toLowerCase();
            return userAgent.indexOf('micromessenger') !== -1;
        }

        // 如果是微信浏览器，添加提示
        if (isWeChatBrowser()) {
            console.log('正在微信浏览器中打开');
        }

        // 添加云雾动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0% { transform: translate(0, 0) scale(1); }
                50% { transform: translate(${Math.random() * 100 - 50}px, ${Math.random() * 50 - 25}px) scale(${Math.random() * 0.5 + 0.8}); }
                100% { transform: translate(0, 0) scale(1); }
            }

            /* 骰子样式 */
            .dice-container {
                display: flex;
                justify-content: center;
                gap: 20px;
                margin: 20px 0;
            }

            .dice {
                width: 60px;
                height: 60px;
                background-color: rgba(245, 245, 220, 0.8);
                border: 2px solid #d4af37;
                border-radius: 10px;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 24px;
                font-weight: bold;
                color: #333;
                box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
                transition: all 0.3s ease;
            }

            /* 骰子滚动动画 */
            .rolling {
                animation: roll 1.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            }

            @keyframes roll {
                0% { transform: rotate(0deg) scale(1); }
                25% { transform: rotate(90deg) scale(1.1); }
                50% { transform: rotate(180deg) scale(1); }
                75% { transform: rotate(270deg) scale(1.1); }
                100% { transform: rotate(360deg) scale(1); }
            }

            .dice-result {
                text-align: center;
                font-size: 18px;
                margin: 20px 0;
                font-weight: bold;
            }
        `;
        document.head.appendChild(style);

        // 初始化云雾
        createFog();

        // 页面加载完成后执行
        // window.addEventListener('load', function() {
        //     // 获取所有剧情场景
        //     const scenes = document.querySelectorAll('.scene');
            
        //     scenes.forEach(scene => {
        //         // 检查场景中是否已有按钮
        //         const hasButtons = scene.querySelector('.choice-btn') !== null;
        //         // 新增：检查当前场景是否是离开页面（替换为你的离开页面ID）
        //         const isExitPage = scene.id === '紫来洞-离开-scene'; // 假设离开页面ID是'神行符-scene'
                
        //         // 只给没有按钮且不是离开页面的场景添加离开按钮
        //         if (!hasButtons && !isExitPage) {
        //             const exitBtn = document.createElement('button');
        //             exitBtn.textContent = '离开';
        //             exitBtn.className = 'exit-btn';
        //             exitBtn.onclick = function() {
        //                 // 点击离开按钮时显示提示框（示例使用hintModal2）
        //                 document.getElementById('hintModal2').classList.add('active');
        //             };
        //             scene.appendChild(exitBtn);
        //         }
        //         // ...原有离开按钮逻辑...
        //     });
        // });
    </script>
</body>
</html>

        

